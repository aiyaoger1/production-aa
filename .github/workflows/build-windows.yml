name: 构建生产下单系统EXE

# 触发条件 - 简单配置
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build-windows-exe:
    runs-on: windows-latest
    
    steps:
      # 步骤1：获取代码
      - name: 检出代码
        uses: actions/checkout@v4
      
      # 步骤2：设置Python
      - name: 设置Python环境
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      # 步骤3：验证文件 (第20-40行)
      - name: 检查必要文件
        shell: pwsh
        run: |
          Write-Host "检查文件..."
          if (-not (Test-Path "app.py")) {
            Write-Host "app.py不存在，创建简单版本..."
            @'
from flask import Flask
app = Flask(__name__)

@app.route('/')
def home():
    return "<h1>生产下单系统</h1><p>EXE版本运行成功</p>"

if __name__ == '__main__':
    app.run(debug=False, port=5000)
'@ | Out-File -FilePath "app.py" -Encoding UTF8
          }
          Write-Host "✅ 文件准备完成"
      
      # 步骤4：安装依赖 (第43-50行) <- 注意这里是关键区域
      - name: 安装Python包
        run: |
          pip install flask pyinstaller
      
      # 步骤5：打包EXE (第52-60行)
      - name: 生成可执行文件
        run: |
          pyinstaller --onefile --name "生产下单系统" app.py
      
      # 步骤6：上传结果 (第62-68行)
      - name: 上传EXE文件
        uses: actions/upload-artifact@v4
        with:
          name: 生产系统EXE
          path: dist/生产下单系统.exe
